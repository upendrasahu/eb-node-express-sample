packages:
    yum:
        sysstat: []

files:
  "/tmp/install.sh":
    mode: "000755"
    owner: root
    group: root
    source: https://raw.githubusercontent.com/snappyflow/apm-agent/master/install.sh
    
  "/tmp/configure_sfagent.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #! /bin/bash
      echo "Replace Config"
      curl -o /opt/sfagent-config.yaml https://raw.githubusercontent.com/ruchira27/projectConfig/main/linux-config
      mv -f /opt/sfagent-config.yaml /opt/sfagent/config.yaml

commands:
  10-sfagent-install:
    command: bash /tmp/install.sh > /tmp/sfagent_install.log 2>&1; echo
    cwd: /tmp
    test: '[ -x /tmp/install.sh ]'
  11-sfagent-stop:
    command: service sfagent stop > /dev/null 2>&1; echo
    cwd: /opt/sfagent
    test: '[ -f /opt/sfagent/sfagent ]'
  12-sfagent-config:
    command: sh configure_sfagent.sh; echo
    cwd: /tmp
    test: '[ -x configure_sfagent.sh ]'
  13-sfagent-start:
    command: service sfagent start > /dev/null 2>&1; echo
    cwd: /opt/sfagent
    test: '[ -f /opt/sfagent/sfagent ]'

