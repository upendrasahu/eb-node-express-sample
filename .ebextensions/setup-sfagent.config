packages:
    yum:
        sysstat: []
files:
  "/opt/sfagent_installation.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #! /bin/bash
      # Install sfagent
      echo "download installer"
      curl -fsSL -o /opt/install.sh https://raw.githubusercontent.com/snappyflow/apm-agent/master/install.sh
      echo "change mod"
      chmod +x /opt/install.sh
      echo "run installer"
      /opt/install.sh
      echo "replace config"
      curl -o /opt/sfagent-config.yaml https://raw.githubusercontent.com/ruchira27/projectConfig/main/linux-config
      mv -f /opt/sfagent-config.yaml /opt/sfagent/config.yaml
      # Install sysstat
      echo "install sysstat"
      yum -y install sysstat
      echo "restart service"
      service sfagent restart
      exit 0

commands:
  "sfagent_install":
    command: /opt/sfagent_installation.sh >> /opt/sfagent_install.log
    cwd: /opt
    ignoreErrors: false
    test: echo "Start sfagent installation" > /opt/sfagent_install.log


